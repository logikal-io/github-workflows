name: Run Cloud Run job
on:
  workflow_call:
    inputs:
      workload-identity-provider:
        description: Full identifier of the GitHub workload identity pool provider in Google Cloud
        type: string
        required: true
      service-account-email:
        description: Email of the Google Cloud service account for running the maintenance
        type: string
        required: true
      region:
        description: The Google Cloud region to use
        type: string
        required: true
      name:
        description: The name of the job
        type: string
        required: true
      args:
        description: The arguments to use
        type: string
        required: true

concurrency: ${{ github.workflow_ref }}-${{ github.ref || github.run_id }}

jobs:
  run-job:
    name: Run job
    runs-on: ubuntu-24.04
    permissions:
      contents: read
      id-token: write
    steps:
      - name: Check out repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: Authenticate to Google Cloud Platform
        uses: google-github-actions/auth@v3
        id: gcp
        with:
          workload_identity_provider: ${{ inputs.workload-identity-provider }}
          service_account: ${{ inputs.service-account-email }}

      - name: Run job
        run: |-
          gcloud run jobs execute "${{ inputs.name }}" \
            --region "${{ inputs.region }}" \
            --args '${{ inputs.args }}' --wait
